<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cap√≠tulo 19 - Otimiza√ß√£o de Consulta - Resumo Detalhado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .overview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }
        
        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
        }
        
        .section-19-1 { border-left-color: #e74c3c; }
        .section-19-2 { border-left-color: #f39c12; }
        .section-19-3 { border-left-color: #2ecc71; }
        .section-19-4 { border-left-color: #3498db; }
        .section-19-5 { border-left-color: #9b59b6; }
        .section-19-6 { border-left-color: #1abc9c; }
        .section-19-7 { border-left-color: #34495e; }
        .section-19-8 { border-left-color: #e67e22; }
        .section-19-9 { border-left-color: #8e44ad; }
        .section-19-10 { border-left-color: #27ae60; }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
        }
        
        .section-icon {
            width: 32px;
            height: 32px;
            margin-right: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .subsection {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 3px solid #3498db;
        }
        
        .subsection h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .concept-box {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .example-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .important-note {
            background: #ffe6e6;
            border: 1px solid #ff7675;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .formula {
            background: #e8f5e8;
            border: 1px solid #00b894;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        
        .algorithm-steps {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .algorithm-steps ol {
            margin-left: 20px;
        }
        
        .algorithm-steps li {
            margin: 10px 0;
            padding: 5px;
        }
        
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .highlight-list {
            list-style: none;
        }
        
        .highlight-list li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .highlight-list li:before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            color: #3498db;
            font-weight: bold;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .comparison-table th {
            background: #3498db;
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Cap√≠tulo 19: Otimiza√ß√£o de Consulta</h1>
            <p class="subtitle">Resumo Detalhado e Aprofundado</p>
        </div>

        <div class="overview">
            <h3>üéØ Vis√£o Geral do Cap√≠tulo</h3>
            <p><strong>Objetivo Principal:</strong> Selecionar a melhor estrat√©gia poss√≠vel para avalia√ß√£o de consultas em SGBDs relacionais, transformando consultas em formas equivalentes mais eficientes.</p>
            <p><strong>Conceito Fundamental:</strong> O termo "otimiza√ß√£o" √© tecnicamente incorreto, pois o plano escolhido nem sempre √© o √≥timo absoluto, mas sim o mais eficiente dentre as alternativas consideradas com as informa√ß√µes dispon√≠veis.</p>
        </div>

        <!-- Se√ß√£o 19.1 -->
        <div class="section section-19-1">
            <h2><span class="section-icon">1</span>19.1 √Årvores de Consulta e Heur√≠stica</h2>
            
            <div class="subsection">
                <h3>üå≥ 19.1.1 Nota√ß√£o para √Årvores e Grafos de Consulta</h3>
                
                <div class="concept-box">
                    <h4>√Årvore de Consulta</h4>
                    <p>Estrutura de dados que corresponde a uma express√£o estendida da √°lgebra relacional:</p>
                    <ul>
                        <li><strong>N√≥s folha:</strong> Rela√ß√µes de entrada da consulta</li>
                        <li><strong>N√≥s internos:</strong> Opera√ß√µes da √°lgebra relacional</li>
                        <li><strong>Execu√ß√£o:</strong> Das folhas para a raiz</li>
                    </ul>
                </div>
                
                <div class="concept-box">
                    <h4>Grafo de Consulta</h4>
                    <p>Representa√ß√£o mais neutra da consulta:</p>
                    <ul>
                        <li><strong>C√≠rculos simples:</strong> N√≥s de rela√ß√£o</li>
                        <li><strong>C√≠rculos duplos:</strong> Valores constantes</li>
                        <li><strong>Arestas:</strong> Condi√ß√µes de sele√ß√£o e jun√ß√£o</li>
                        <li><strong>Colchetes:</strong> Atributos a serem recuperados</li>
                    </ul>
                </div>
                
                <div class="important-note">
                    <strong>Diferen√ßa Fundamental:</strong> √Årvores de consulta mostram ordem espec√≠fica de opera√ß√µes; grafos de consulta n√£o indicam ordem, sendo mais neutros.
                </div>
            </div>

            <div class="subsection">
                <h3>‚ö° 19.1.2 Otimiza√ß√£o Heur√≠stica das √Årvores de Consulta</h3>
                
                <div class="example-box">
                    <h4>Problema da √Årvore Can√¥nica</h4>
                    <p>O analisador SQL gera inicialmente uma √°rvore "can√¥nica" muito ineficiente que aplica PRODUTO CARTESIANO primeiro, depois condi√ß√µes WHERE, depois SELECT. Para rela√ß√µes com 100, 20 e 5.000 tuplas, isso geraria 10 milh√µes de tuplas intermedi√°rias!</p>
                </div>
                
                <div class="algorithm-steps">
                    <h4>üîß Algoritmo de Otimiza√ß√£o Heur√≠stica (6 Etapas)</h4>
                    <ol>
                        <li><strong>Cascata de SELE√á√ÉO:</strong> Decomponha condi√ß√µes conjuntivas (AND) em opera√ß√µes SELE√á√ÉO individuais usando Regra 1</li>
                        <li><strong>Movimento de SELE√á√ÉO para baixo:</strong> Use regras de comutatividade para mover sele√ß√µes o mais pr√≥ximo poss√≠vel das folhas</li>
                        <li><strong>Reorganiza√ß√£o de folhas:</strong> Posicione rela√ß√µes com sele√ß√µes mais restritivas primeiro, evitando produtos cartesianos</li>
                        <li><strong>Substitui√ß√£o de PRODUTO CARTESIANO:</strong> Combine opera√ß√µes x + œÉ em opera√ß√µes JOIN (‚ãà)</li>
                        <li><strong>Movimento de PROJE√á√ÉO para baixo:</strong> Mantenha apenas atributos necess√°rios em cada opera√ß√£o</li>
                        <li><strong>Agrupamento de opera√ß√µes:</strong> Identifique sub√°rvores execut√°veis por algoritmos √∫nicos</li>
                    </ol>
                </div>
                
                <div class="two-column">
                    <div>
                        <h4>üìã Regras de Transforma√ß√£o Principais</h4>
                        <ul class="highlight-list">
                            <li>Cascata de œÉ: œÉc1‚àßc2‚àß...‚àßcn(R) = œÉc1(œÉc2(...(œÉcn(R))...))</li>
                            <li>Comutatividade de œÉ: œÉc1(œÉc2(R)) = œÉc2(œÉc1(R))</li>
                            <li>Cascata de œÄ: œÄlist1(œÄlist2(...(œÄlistn(R))...)) = œÄlist1(R)</li>
                            <li>Comutatividade de ‚ãà: R ‚ãà S = S ‚ãà R</li>
                        </ul>
                    </div>
                    <div>
                        <h4>üéØ Heur√≠stica Principal</h4>
                        <ul class="highlight-list">
                            <li>Aplicar opera√ß√µes que reduzem tamanho primeiro</li>
                            <li>SELE√á√ÉO e PROJE√á√ÉO antes de JOIN</li>
                            <li>Opera√ß√µes mais restritivas primeiro</li>
                            <li>Evitar produtos cartesianos</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 19.2 -->
        <div class="section section-19-2">
            <h2><span class="section-icon">2</span>19.2 Planos de Execu√ß√£o de Consulta</h2>
            
            <div class="subsection">
                <h3>üîÑ 19.2.1 Alternativas para Avalia√ß√£o de Consulta</h3>
                
                <div class="two-column">
                    <div class="concept-box">
                        <h4>Avalia√ß√£o Materializada</h4>
                        <ul>
                            <li>Resultado de cada opera√ß√£o armazenado como rela√ß√£o tempor√°ria</li>
                            <li>Opera√ß√£o seguinte l√™ resultado materializado</li>
                            <li>Maior uso de espa√ßo em disco</li>
                            <li>Menor uso de mem√≥ria</li>
                        </ul>
                    </div>
                    <div class="concept-box">
                        <h4>Avalia√ß√£o Pipeline</h4>
                        <ul>
                            <li>Tuplas passadas diretamente entre opera√ß√µes</li>
                            <li>Economia de E/S de disco</li>
                            <li>Maior uso de mem√≥ria</li>
                            <li>Prefer√≠vel quando vi√°vel</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>üîó 19.2.2 Otimiza√ß√£o de Subconsulta Aninhada</h3>
                
                <div class="example-box">
                    <h4>Problema das Subconsultas Correlacionadas</h4>
                    <p><strong>Estrat√©gia ing√™nua:</strong> Avaliar subconsulta interna para cada tupla externa - muito ineficiente!</p>
                    <p><strong>Solu√ß√£o:</strong> <em>Desaninhamento (Unnesting)</em> - converter em opera√ß√£o de jun√ß√£o sempre que poss√≠vel.</p>
                </div>
                
                <div class="algorithm-steps">
                    <h4>T√©cnicas de Desaninhamento</h4>
                    <ol>
                        <li><strong>IN/ANY:</strong> Converter para jun√ß√£o interna quando apropriado</li>
                        <li><strong>EXISTS:</strong> Usar semijun√ß√£o (‚ãâ) para evitar duplicatas</li>
                        <li><strong>NOT IN:</strong> Usar antijun√ß√£o (‚ñ∑) para exclus√£o</li>
                        <li><strong>Tabelas tempor√°rias:</strong> Para subconsultas complexas</li>
                    </ol>
                </div>
            </div>

            <div class="subsection">
                <h3>üîÑ 19.2.3 Transforma√ß√£o de Mesclagem de Vis√£o</h3>
                
                <div class="concept-box">
                    <h4>Mesclagem de Vis√£o Simples</h4>
                    <p>Vis√µes com opera√ß√µes sele√ß√£o-proje√ß√£o-jun√ß√£o podem sempre ser mescladas ao bloco de consulta externo, oferecendo:</p>
                    <ul>
                        <li>Mais op√ß√µes de ordem de jun√ß√£o</li>
                        <li>Uso de √≠ndices nas rela√ß√µes base</li>
                        <li>Elimina√ß√£o de materializa√ß√µes intermedi√°rias</li>
                    </ul>
                </div>
                
                <div class="important-note">
                    <h4>Mesclagem com GROUP BY</h4>
                    <p><strong>Decis√£o baseada em custo:</strong> Comparar custo da vis√£o materializada vs. jun√ß√£o primeiro + agrupamento depois. A mesclagem pode ser ben√©fica quando as jun√ß√µes t√™m baixa seletividade.</p>
                </div>
            </div>

            <div class="subsection">
                <h3>üíæ 19.2.4 Vis√µes Materializadas</h3>
                
                <div class="two-column">
                    <div>
                        <h4>Estrat√©gias de Atualiza√ß√£o</h4>
                        <ul class="highlight-list">
                            <li><strong>Imediata:</strong> Atualiza vis√£o a cada mudan√ßa na base</li>
                            <li><strong>Adiada:</strong> Recomputa apenas sob demanda</li>
                            <li><strong>Peri√≥dica:</strong> Atualiza em intervalos regulares</li>
                        </ul>
                    </div>
                    <div>
                        <h4>Manuten√ß√£o Incremental</h4>
                        <ul class="highlight-list">
                            <li>Mais eficiente que recomputa√ß√£o total</li>
                            <li>Baseia-se apenas nas mudan√ßas</li>
                            <li>Uso de triggers para automatiza√ß√£o</li>
                            <li>Contadores para proje√ß√µes com DISTINCT</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 19.3 -->
        <div class="section section-19-3">
            <h2><span class="section-icon">3</span>19.3 Seletividades e Otimiza√ß√£o Baseada em Custo</h2>
            
            <div class="subsection">
                <h3>üí∞ 19.3.1 Componentes de Custo</h3>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Componente</th>
                            <th>Descri√ß√£o</th>
                            <th>Import√¢ncia</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>E/S de Disco</strong></td>
                            <td>Transfer√™ncia de blocos entre disco e mem√≥ria</td>
                            <td>Prim√°ria para BDs grandes</td>
                        </tr>
                        <tr>
                            <td><strong>Armazenamento</strong></td>
                            <td>Custo de arquivos intermedi√°rios</td>
                            <td>Secund√°ria</td>
                        </tr>
                        <tr>
                            <td><strong>CPU</strong></td>
                            <td>Opera√ß√µes em mem√≥ria (busca, ordena√ß√£o)</td>
                            <td>Prim√°ria para BDs pequenos</td>
                        </tr>
                        <tr>
                            <td><strong>Mem√≥ria</strong></td>
                            <td>N√∫mero de buffers necess√°rios</td>
                            <td>Secund√°ria</td>
                        </tr>
                        <tr>
                            <td><strong>Comunica√ß√£o</strong></td>
                            <td>Envio de consultas/resultados</td>
                            <td>Prim√°ria para BDs distribu√≠dos</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="subsection">
                <h3>üìä 19.3.2 Informa√ß√µes do Cat√°logo</h3>
                
                <div class="two-column">
                    <div>
                        <h4>Estat√≠sticas de Arquivo</h4>
                        <ul class="highlight-list">
                            <li><strong>r:</strong> N√∫mero de registros</li>
                            <li><strong>R:</strong> Tamanho m√©dio do registro</li>
                            <li><strong>b:</strong> N√∫mero de blocos</li>
                            <li><strong>bfr:</strong> Fator de bloco</li>
                        </ul>
                    </div>
                    <div>
                        <h4>Estat√≠sticas de √çndice</h4>
                        <ul class="highlight-list">
                            <li><strong>x:</strong> N√≠veis do √≠ndice</li>
                            <li><strong>NVD(A,R):</strong> Valores distintos</li>
                            <li><strong>sl:</strong> Seletividade</li>
                            <li><strong>s:</strong> Cardinalidade de sele√ß√£o</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>üìà 19.3.3 Histogramas</h3>
                
                <div class="concept-box">
                    <h4>Tipos de Histogramas</h4>
                    <div class="two-column">
                        <div>
                            <h5>Equilargura</h5>
                            <p>Intervalos de valores divididos em subfaixas iguais</p>
                        </div>
                        <div>
                            <h5>Equialtura (Prefer√≠vel)</h5>
                            <p>Cada bucket com aproximadamente o mesmo n√∫mero de registros</p>
                        </div>
                    </div>
                </div>
                
                <div class="important-note">
                    <strong>Vantagem dos Equialtura:</strong> Melhor distribui√ß√£o de valores frequentes vs. raros, mantendo suposi√ß√£o de uniformidade dentro de cada bucket mais realista.
                </div>
            </div>
        </div>

        <!-- Se√ß√£o 19.4 -->
        <div class="section section-19-4">
            <h2><span class="section-icon">4</span>19.4 Fun√ß√µes de Custo para SELE√á√ÉO</h2>
            
            <div class="subsection">
                <h3>üîç Algoritmos de Sele√ß√£o e Custos</h3>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>M√©todo</th>
                            <th>T√©cnica</th>
                            <th>F√≥rmula de Custo</th>
                            <th>Quando Usar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>S1</strong></td>
                            <td>Busca Linear</td>
                            <td>C = b (ou b/2 para chave)</td>
                            <td>Sem √≠ndice dispon√≠vel</td>
                        </tr>
                        <tr>
                            <td><strong>S2</strong></td>
                            <td>Busca Bin√°ria</td>
                            <td>C = log‚ÇÇb + ‚åàs/bfr‚åâ - 1</td>
                            <td>Arquivo ordenado</td>
                        </tr>
                        <tr>
                            <td><strong>S3a</strong></td>
                            <td>√çndice Prim√°rio</td>
                            <td>C = x + 1</td>
                            <td>Condi√ß√£o igualdade em chave</td>
                        </tr>
                        <tr>
                            <td><strong>S3b</strong></td>
                            <td>Hash</td>
                            <td>C = 1 (est√°tico) ou 2 (extens√≠vel)</td>
                            <td>Acesso direto por chave</td>
                        </tr>
                        <tr>
                            <td><strong>S5</strong></td>
                            <td>√çndice Agrupamento</td>
                            <td>C = x + ‚åàs/bfr‚åâ</td>
                            <td>M√∫ltiplos registros pr√≥ximos</td>
                        </tr>
                        <tr>
                            <td><strong>S6</strong></td>
                            <td>√çndice Secund√°rio</td>
                            <td>C = x + 1 + s (n√£o-chave)</td>
                            <td>Atributos n√£o-ordenados</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="subsection">
                <h3>üí° 19.4.1 Exemplo de Otimiza√ß√£o</h3>
                
                <div class="example-box">
                    <h4>Cen√°rio: Arquivo FUNCIONARIO</h4>
                    <ul>
                        <li><strong>Registros:</strong> 10.000 tuplas em 2.000 blocos</li>
                        <li><strong>√çndice agrupamento em Sal√°rio:</strong> 3 n√≠veis, seletividade m√©dia = 20</li>
                        <li><strong>√çndice secund√°rio em CPF:</strong> 4 n√≠veis (chave √∫nica)</li>
                        <li><strong>√çndice secund√°rio em N√∫mero_departamento:</strong> 2 n√≠veis, 125 valores distintos</li>
                    </ul>
                    
                    <h4>An√°lise de Consultas:</h4>
                    <div class="formula">
                        OP1: œÉCpf='12345678966'(FUNCIONARIO)<br>
                        ‚Üí Escolha S6a: C = 4 + 1 = 5 vs. S1: C = 1000
                    </div>
                    
                    <div class="formula">
                        OP3: œÉNumero_departamento=5(FUNCIONARIO)<br>
                        ‚Üí Escolha S6a: C = 2 + 80 = 82 vs. S1: C = 2000
                    </div>
                </div>
            </div>
        </div>
</body>